{
  "doc_id": "BR-0001",
  "jira": "TEST-BR-001",
  "status": "Completed",
  "date": "01/07/2026",
  "reported_by": "Alex Kirby",
  "assigned_to": "Alex Kirby",
  "schema": "dbo",
  "table": "Customers",
  "column": "EmailAddress",
  "data_type": "VARCHAR(255)",
  "values": "**Valid Email** = Standard email format (user@domain.com)\n**Invalid Email** = Rejected by validation",
  "purpose": "Enhanced data quality by preventing invalid email addresses from being stored in customer records. Ensures all customer communications reach valid email addresses and maintains data integrity standards.",
  "summary": "This business request implements comprehensive email format validation for customer records using advanced regex pattern matching with stored procedure integration. The implementation follows enterprise data validation standards with proper error handling and audit trail capabilities.",
  "rule_def": "**Validation Logic:**\nAn email is considered valid when:\n- It follows RFC 5322 standard email format (user@domain.com)\n- Contains valid domain with proper TLD (.com, .org, etc.)\n- No special characters that break email standards\n- Minimum 5 characters, maximum 254 characters\n- No consecutive dots or leading/trailing dots\n\n**Implementation Approach:**\nThe system uses multi-layered validation within stored procedures:\n- Primary regex validation for format compliance\n- Domain validation against whitelist if configured\n- Real-time feedback with specific error messages\n- Integration with existing audit and logging systems",
  "code": "-- BEGIN TEST-BR-001: Comprehensive Email Validation Enhancement\nALTER PROCEDURE daqa.usp_ValidateCustomer\n    @CustomerID INT,\n    @EmailAddress VARCHAR(255),\n    @ValidationLevel VARCHAR(20) = 'STANDARD'\nAS\nBEGIN\n    SET NOCOUNT ON;\n    DECLARE @ValidationResult VARCHAR(500) = 'VALID';\n    \n    -- Email format validation with comprehensive regex patterns\n    IF @EmailAddress IS NULL OR LEN(@EmailAddress) < 5 OR LEN(@EmailAddress) > 254\n    BEGIN\n        SET @ValidationResult = 'Invalid email length: must be between 5-254 characters';\n        RAISERROR(@ValidationResult, 16, 1);\n        RETURN;\n    END\n    \n    -- RFC 5322 compliant validation\n    IF @EmailAddress NOT LIKE '%_@_%.__%'\n       OR @EmailAddress LIKE '%..%'\n       OR @EmailAddress LIKE '%@%@%'\n       OR @EmailAddress LIKE '%.@%'\n       OR @EmailAddress LIKE '%@.%'\n       OR @EmailAddress LIKE '.%'\n       OR @EmailAddress LIKE '%.'\n    BEGIN\n        SET @ValidationResult = 'Invalid email format: ' + @EmailAddress;\n        RAISERROR(@ValidationResult, 16, 1);\n        RETURN;\n    END\n    \n    -- Enhanced validation for enterprise level\n    IF @ValidationLevel = 'ENTERPRISE'\n    BEGIN\n        -- Check against domain whitelist (if configured)\n        IF NOT EXISTS (\n            SELECT 1 FROM gwControl.ApprovedEmailDomains \n            WHERE @EmailAddress LIKE '%@' + DomainName\n        )\n        BEGIN\n            SET @ValidationResult = 'Domain not in approved enterprise list';\n            RAISERROR(@ValidationResult, 16, 1);\n            RETURN;\n        END\n    END\n    \n    -- Update customer record with audit trail\n    UPDATE Customers\n    SET EmailAddress = @EmailAddress,\n        ModifiedDate = GETDATE(),\n        ModifiedBy = SUSER_SNAME(),\n        ValidationLevel = @ValidationLevel\n    WHERE CustomerID = @CustomerID;\n    \n    -- Log successful validation\n    INSERT INTO gwAudit.EmailValidationLog\n    (CustomerID, EmailAddress, ValidationLevel, ValidationResult, CreatedDate)\n    VALUES (@CustomerID, @EmailAddress, @ValidationLevel, @ValidationResult, GETDATE());\n    \n    PRINT 'Email validation successful for: ' + @EmailAddress;\nEND\n-- END TEST-BR-001",
  "code_explain": "**Multi-Phase Validation Architecture:**\n\n**Phase 1: Basic Format Validation**\n- Validates email length constraints (5-254 characters per RFC standards)\n- Implements comprehensive LIKE pattern matching for format compliance\n- Checks for common malformation patterns (double dots, multiple @ signs)\n- Prevents leading/trailing dots and malformed domain structures\n\n**Phase 2: Enterprise-Level Validation**\n- Optional enterprise validation level for stricter requirements\n- Domain whitelist validation against approved corporate domains\n- Configurable validation levels (STANDARD vs ENTERPRISE)\n- Integration with existing control tables for flexible rule management\n\n**Phase 3: Update and Audit Trail**\n- Updates customer record only after successful validation\n- Maintains comprehensive audit trail with user tracking\n- Logs all validation attempts for compliance and troubleshooting\n- Uses SUSER_SNAME() for security context preservation\n\n**Performance and Security Considerations:**\n- SET NOCOUNT ON for reduced network traffic\n- Parameterized approach prevents SQL injection\n- Efficient LIKE pattern matching over regex for performance\n- Proper error handling with descriptive messages\n- Integration with existing audit framework\n- Single transaction scope for data consistency",
  "control_table": "gwControl.ApprovedEmailDomains",
  "table_desc": "Enterprise-level control table for managing approved email domains in corporate environments. Enables centralized management of acceptable email domains for customer communications, supporting both internal corporate domains and approved external partners. Includes effective date ranges and business justification tracking.",
  "key_columns": [
    "CustomerID - Primary key identifier for customer records",
    "EmailAddress - Customer email address (now with comprehensive validation)",
    "ModifiedDate - Audit trail timestamp for email updates",
    "ModifiedBy - User context for security and audit compliance",
    "ValidationLevel - Validation strictness level (STANDARD/ENTERPRISE)",
    "DomainName - Approved email domain from control table",
    "EffectiveDate - Domain approval effective date",
    "ExpirationDate - Domain approval expiration (NULL for permanent)"
  ]
}